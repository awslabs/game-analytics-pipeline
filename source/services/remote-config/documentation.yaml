openapi: 3.0.0
info:
  version: 1.0.0
  title: AWS Remote Config
  description: |-
    - **[Development URL](https://4nubytbnil.execute-api.cn-north-1.amazonaws.com.cn/dev)**

servers:
- url: https://4nubytbnil.execute-api.cn-north-1.amazonaws.com.cn/dev
tags:
- name: Remote Config
  description: Endpoints called by our client applications to handle remote config
- name: Backoffice Remote Config
  description: Endpoints called by our backoffice to handle remote config

paths:

  #  ----- Remote Config  --------------------------------------------------

  /remote-configs/{user_ID}:
    get:
      summary: Retrieve all remote configs for a user
      description: This endpoint will also place the user in a group for each ABTest for which he does not have a group assigned.
      tags:
      - Remote Config
      parameters:
      - name: user_ID
        in: path
        description: ID of the user
        required: true
        schema:
          type: string
          example: 1234
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                type: object
                properties:
                  remote_configs:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: ButtonColor
                        value_origin:
                          type: string
                          enum:
                          - reference_value
                          - abtest
                        value:
                          type: string
                          example: Blue

  #  ----- Backoffice Remote Config ----------------------------------

  /backoffice/remote-configs:
    get:
      summary: Retrieve all remote configs
      description: This endpoint returns all Remote Configs
      tags:
      - Backoffice Remote Config
      responses:
        '200':
          description:
          content:
            application/json:
              schema:
                type: object
                properties:
                  remote_configs:
                    type: array
                    items:
                      type: object
                      properties:
                        activated:
                          type: boolean
                        application_ID:
                          type: string
                          example: com.geode.dazzly
                        description:
                          type: string
                          example: This remote config allows to handle color button.
                        reference_value:
                          type: string
                          example: "Blue"

    post:
      summary: Create a Remote Config
      description: This endpoint creates a remote config.
      tags:
      - Backoffice Remote Config
      requestBody:
        description: |-
          - You can't create 2 remote configs with the same `name` & `application_ID`
        required: true
        content:
          application/json:
            schema:
              required:
              - application_ID
              - description
              - name
              - reference_value
              type: object
              properties:
                application_ID:
                  type: string
                  example: com.geode.dazzly
                description:
                  type: string
                  example: This remote config allows to handle color button.
                name:
                  type: string
                  example: ColorButton
                reference_value:
                  type: string
                  example: "Blue"
      responses:
        '200':
          description: The remote config was created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  remote_config_ID:
                    type: string
                    example: 7ca85fda-c5c5-4180-9207-f2971fca6e01
        '400':
          description: The remote config has NOT been created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

  /backoffice/remote-configs/{remote_config_ID}:
    put:
      summary: Update a Remote Config
      description: This endpoint updates a remote config.
      tags:
      - Backoffice Remote Config
      parameters:
      - name: remote_config_ID
        in: path
        description: ID of the remote config
        required: true
        schema:
          type: string
          example: 7ca85fda-c5c5-4180-9207-f2971fca6e01
      requestBody:
        description: |-
          - you can't use a `name` that has already been used by another remote config on the same application_ID
          - You can't update `name` and `reference_value` if this remote config is activated.
        required: true
        content:
          application/json:
            schema:
              required:
              - description
              - name
              - reference_value
              type: object
              properties:
                description:
                  type: string
                  example: This remote config allows to handle color button.
                name:
                  type: string
                  example: ColorButton
                reference_value:
                  type: string
                  example: "Blue"
      responses:
        '204':
          description: The remote config was updated successfully
        '400':
          description: The remote config has NOT been updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

    delete:
      summary: Delete a Remote Config
      description: This endpoint deletes a remote config. You can't delete an activated remote config
      tags:
      - Backoffice Remote Config
      parameters:
      - name: remote_config_ID
        in: path
        description: ID of the remote config
        required: true
        schema:
          type: string
          example: 7ca85fda-c5c5-4180-9207-f2971fca6e01
      responses:
        '204':
          description: The remote config was deleted successfully
        '400':
          description: The remote config has NOT been deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

  /backoffice/remote-configs/{remote_config_ID}/activate:
    post:
      summary: Activate a Remote Config
      description: This endpoint activates a remote config.
      tags:
      - Backoffice Remote Config
      parameters:
      - name: remote_config_ID
        in: path
        description: ID of the remote config
        required: true
        schema:
          type: string
          example: 7ca85fda-c5c5-4180-9207-f2971fca6e01
      responses:
        '204':
          description: The remote config was activated successfully

  /backoffice/remote-configs/{remote_config_ID}/abtest:
    post:
      summary: Create an ABTest
      description: This endpoint creates an ABTest for a remote config
      tags:
      - Backoffice Remote Config
      parameters:
      - name: remote_config_ID
        in: path
        description: ID of the remote config
        required: true
        schema:
          type: string
          example: 7ca85fda-c5c5-4180-9207-f2971fca6e01
      requestBody:
        description: |-
          - The same remote config cannot have 2 ABTests with the same `name`.

          - `target_user_percent` must be between 0 ad 100
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: LightColors
                target_user_percent:
                  type: integer
                  example: 100
                variants:
                  type: array
                  items:
                    type: string
                  example:
                  - Green
                  - Yellow
      responses:
        '200':
          description: The ABTest has been created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  abtest_ID:
                    type: string
                    example: 3bb3e26e-8b88-4b37-b8c6-b5d5e9090eaa
        '400':
          description: The remote config has NOT been created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

  /backoffice/remote-configs/abtests/{abtest_ID}:
    put:
      summary: Update an ABTest
      description: This endpoint updates an ABtest.
      tags:
      - Backoffice Remote Config
      parameters:
      - name: abtest_ID
        in: path
        description: ID of the ABTest
        required: true
        schema:
          type: string
          example: 3bb3e26e-8b88-4b37-b8c6-b5d5e9090eaa
      requestBody:
        description: |-
          - You can't update an activated ABTest.
        required: true
        content:
          application/json:
            schema:
              required:
              - target_user_percent
              - variants
              type: object
              properties:
                name:
                  type: string
                  example: LightColors
                target_user_percent:
                  type: integer
                  example: 100
                variants:
                  type: array
                  items:
                    type: string
                  example:
                  - Red
                  - Green
      responses:
        '204':
          description: The ABTest was updated successfully
        '400':
          description: The ABTest has NOT been updated because this ABTest is activated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

    delete:
      summary: Delete an ABTest
      description: This endpoint deletes an ABTest. You can't delete an activated ABTest
      tags:
      - Backoffice Remote Config
      parameters:
      - name: abtest_ID
        in: path
        description: ID of the ABTest
        required: true
        schema:
          type: string
          example: 3bb3e26e-8b88-4b37-b8c6-b5d5e9090eaa
      responses:
        '204':
          description: The ABTest was deleted successfully
        '400':
          description: The ABTest has NOT been deleted because the ABTest is activated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

  /backoffice/remote-configs/abtests/{abtest_ID}/activate:
    post:
      summary: Activate an ABTest
      description: |-
        This endpoint activates an ABTest. You can active an ABTest only if :
        - his remote config is activate
        - there isn't another ABTest already activated on this remote config
        - there are not already 4 ABTests activated on the application_ID link to the remote config.
      tags:
      - Backoffice Remote Config
      parameters:
      - name: abtest_ID
        in: path
        description: ID of the ABTest
        required: true
        schema:
          type: string
          example: 3bb3e26e-8b88-4b37-b8c6-b5d5e9090eaa
      requestBody:
        description: |-
          - `start_timestamp` is optional. It must be greater than the current timestamp. Its default value is the current timestamp.
        required: true
        content:
          application/json:
            schema:
              required:
              type: object
              properties:
                start_timestamp:
                  type: integer
                  example: 1692794054
      responses:
        '204':
          description: The ABTest was activated successfully
        '400':
          description: The ABTest has NOT been activated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

  /backoffice/remote-configs/abtests/{abtest_ID}/pause:
    post:
      summary: Pause an ABTest
      description: |-
        - This endpoint pauses an ABTest
        - You can only pause an activated ABTest.
      tags:
      - Backoffice Remote Config
      parameters:
      - name: abtest_ID
        in: path
        description: ID of the ABTest
        required: true
        schema:
          type: string
          example: 3bb3e26e-8b88-4b37-b8c6-b5d5e9090eaa
      requestBody:
        description:
        required: true
        content:
          application/json:
            schema:
              required:
              - paused
              type: object
              properties:
                paused:
                  type: boolean
      responses:
        '204':
          description: The ABTest has been paused
        '400':
          description: The ABTest has NOT been paused
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

  /backoffice/remote-configs/abtests/{abtest_ID}/promote:
    post:
      summary: Promote an ABTest
      description: This endpoint promotes an ABTest by selecting the new reference_value
      tags:
      - Backoffice Remote Config
      parameters:
      - name: abtest_ID
        in: path
        description: ID of the ABTest
        required: true
        schema:
          type: string
          example: 3bb3e26e-8b88-4b37-b8c6-b5d5e9090eaa
      requestBody:
        description: |-
          - You can only promote an activated ABTest.

          - `promoted_value` should be reference_value of a variant
        required: true
        content:
          application/json:
            schema:
              required:
              - promoted_value
              type: object
              properties:
                promoted_value:
                  type: integer
                  example: 1692794054
      responses:
        '204':
          description: The reference_value of the remote config has been replaced by promoted_value
        '400':
          description: The ABTest has NOT been promoted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'

components:
  schemas:
    errorResponse:
      type: object
      properties:
        error:
          type: string
          example: Description of the error...
